#!/bin/bash
set -eu
set -o pipefail

function process()
{ 
    local malware=$1
    if [ ! -f "$MIME_OUTPUT_DIR/$malware" ];
    then
        echo "Processing $malware"
        file -b "$MALWARE_DIR/$malware" -e elf -e encoding |cut -d, -f1,2 > "$MIME_OUTPUT_DIR/$malware"
    else
        echo "$malware has already been processed"
    fi  
}

MALWARE_DIR='/Users/todor/Code/Masters-Thesis-Code/malware-samples'
MIME_OUTPUT_DIR="$MALWARE_DIR/mime-type"
[ ! -d "$MIME_OUTPUT_DIR" ] && mkdir $MIME_OUTPUT_DIR
MALWARES=$(find $MALWARE_DIR -d 1 -type f -not -name '.gitignore' | sed 's#.*/##')
for malware in $MALWARES;do
   process $malware
done
    
