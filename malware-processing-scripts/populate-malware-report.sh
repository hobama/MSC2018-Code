#!/bin/bash
set -eux
set -o pipefail

function process()
{ 
    local malware=$1
    malware_type=$(cat $ELF_TYPE_DIR/$malware)
    psql -c "UPDATE malware_report SET type='$malware_type' WHERE sha256='$malware'"
}

MALWARE_DIR='/Users/todor/Code/Masters-Thesis-Code/malware-samples'
ELF_TYPE_DIR="$MALWARE_DIR/mime-type"
[ ! -d "$ELF_TYPE_DIR" ] && mkdir $ELF_TYPE_DIR
MALWARES=$(find $ELF_TYPE_DIR -d 1 -type f | sed 's#.*/##')
for malware in $MALWARES;do
   process $malware
done
    
